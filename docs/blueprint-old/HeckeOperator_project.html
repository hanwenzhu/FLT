<!DOCTYPE html>
<html lang="en">
<head>
<script>
  MathJax = { 
    tex: {
		    inlineMath: [['$','$'], ['\\(','\\)']]
	} }
</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<meta name="generator" content="plasTeX" />
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Miniproject: Hecke Operators</title>
<link rel="next" href="ch_bestiary.html" title="Appendix: A collection of results which are needed in the proof." />
<link rel="prev" href="Quat_alg_project.html" title="Miniproject: Quaternion algebras" />
<link rel="up" href="index.html" title="Towards a Lean proof of Fermat’s Last Theorem" />
<link rel="stylesheet" href="styles/theme-blue.css" />
<link rel="stylesheet" href="styles/amsthm.css" />
<link rel="stylesheet" href="styles/showmore.css" />
<link rel="stylesheet" href="styles/blueprint.css" />
<link rel="stylesheet" href="styles/stylecours.css" />
</head>

<body>
<header>
<svg  id="toc-toggle" class="icon icon-list-numbered "><use xlink:href="symbol-defs.svg#icon-list-numbered"></use></svg>
<h1 id="doc_title"><a href="index.html">Towards a Lean proof of Fermat’s Last Theorem</a></h1>
</header>

<div class="wrapper">
<nav class="toc">
<ul class="sub-toc-0">
<li class="">
  <a href="sect0001.html"><span class="toc_ref">1</span> <span class="toc_entry">Introduction</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="sect0001.html#a0000000007"><span class="toc_ref">1.1</span> <span class="toc_entry">Which proof is being formalised?</span></a>
 </li>
<li class="">
  <a href="sect0001.html#a0000000008"><span class="toc_ref">1.2</span> <span class="toc_entry">The structure of this blueprint</span></a>
 </li>
<li class="">
  <a href="sect0001.html#a0000000009"><span class="toc_ref">1.3</span> <span class="toc_entry">Remarks</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="ch_reductions.html"><span class="toc_ref">2</span> <span class="toc_entry">First reductions of the problem</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="ch_reductions.html#a0000000010"><span class="toc_ref">2.1</span> <span class="toc_entry">Goal</span></a>
 </li>
<li class="">
  <a href="ch_reductions.html#a0000000011"><span class="toc_ref">2.2</span> <span class="toc_entry">Overview</span></a>
 </li>
<li class="">
  <a href="ch_reductions.html#a0000000012"><span class="toc_ref">2.3</span> <span class="toc_entry">Reduction to \(n\geq 5\) and prime</span></a>
 </li>
<li class="">
  <a href="ch_reductions.html#a0000000013"><span class="toc_ref">2.4</span> <span class="toc_entry">Frey packages</span></a>
 </li>
<li class="">
  <a href="ch_reductions.html#twopointfour"><span class="toc_ref">2.5</span> <span class="toc_entry">Galois representations and elliptic curves</span></a>
 </li>
<li class="">
  <a href="ch_reductions.html#a0000000014"><span class="toc_ref">2.6</span> <span class="toc_entry">The Frey curve</span></a>
 </li>
<li class="">
  <a href="ch_reductions.html#a0000000015"><span class="toc_ref">2.7</span> <span class="toc_entry">Reduction to two big theorems.</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="ch_freyreduction.html"><span class="toc_ref">3</span> <span class="toc_entry">Reducibility of <i class="it">p</i>-torsion of the Frey curve</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="ch_freyreduction.html#a0000000016"><span class="toc_ref">3.1</span> <span class="toc_entry">Overview</span></a>
 </li>
<li class="">
  <a href="ch_freyreduction.html#a0000000017"><span class="toc_ref">3.2</span> <span class="toc_entry">Hardly ramified representations</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="ch_overview.html"><span class="toc_ref">4</span> <span class="toc_entry">An overview of the proof</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="ch_overview.html#a0000000018"><span class="toc_ref">4.1</span> <span class="toc_entry">Potential modularity.</span></a>
 </li>
<li class="">
  <a href="ch_overview.html#a0000000019"><span class="toc_ref">4.2</span> <span class="toc_entry">A modularity lifting theorem</span></a>
 </li>
<li class="">
  <a href="ch_overview.html#a0000000020"><span class="toc_ref">4.3</span> <span class="toc_entry">Compatible families, and reduction at 3</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="sect0002.html"><span class="toc_ref">5</span> <span class="toc_entry">An example of an automorphic form</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="sect0002.html#a0000000021"><span class="toc_ref">5.1</span> <span class="toc_entry">Introduction</span></a>
 </li>
<li class="">
  <a href="sect0002.html#a0000000022"><span class="toc_ref">5.2</span> <span class="toc_entry">A quaternion algebra</span></a>
 </li>
<li class="">
  <a href="sect0002.html#a0000000023"><span class="toc_ref">5.3</span> <span class="toc_entry">\(\widehat{\mathbb {Z}}\)</span></a>
 </li>
<li class="">
  <a href="sect0002.html#a0000000024"><span class="toc_ref">5.4</span> <span class="toc_entry">More advanced remarks on \(\widehat{\mathbb {Z}}\) versus \(\mathbb {Q}\)</span></a>
 </li>
<li class="">
  <a href="sect0002.html#a0000000025"><span class="toc_ref">5.5</span> <span class="toc_entry">\(\widehat{\mathbb {Q}}\) and tensor products.</span></a>
 </li>
<li class="">
  <a href="sect0002.html#a0000000026"><span class="toc_ref">5.6</span> <span class="toc_entry">A crash course in tensor products</span></a>
 </li>
<li class="">
  <a href="sect0002.html#a0000000027"><span class="toc_ref">5.7</span> <span class="toc_entry">Additive structure of \(\widehat{\mathbb {Q}}\).</span></a>
 </li>
<li class="">
  <a href="sect0002.html#a0000000028"><span class="toc_ref">5.8</span> <span class="toc_entry">Multiplicative structure of the units of \(\widehat{\mathbb {Q}}\).</span></a>
 </li>
<li class="">
  <a href="sect0002.html#a0000000029"><span class="toc_ref">5.9</span> <span class="toc_entry">The Hurwitz quaternions</span></a>
 </li>
<li class="">
  <a href="sect0002.html#a0000000030"><span class="toc_ref">5.10</span> <span class="toc_entry">Profinite completion of the Hurwitz quaternions</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="sect0003.html"><span class="toc_ref">6</span> <span class="toc_entry">Stating the modularity lifting theorems</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="sect0003.html#a0000000031"><span class="toc_ref">6.1</span> <span class="toc_entry">Automorphic forms and analysis</span></a>
 </li>
<li class="">
  <a href="sect0003.html#a0000000032"><span class="toc_ref">6.2</span> <span class="toc_entry">Central simple algebras</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="sect0004.html"><span class="toc_ref">7</span> <span class="toc_entry">Automorphic forms and the Langlands Conjectures</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="sect0004.html#a0000000033"><span class="toc_ref">7.1</span> <span class="toc_entry">Definition of an automorphic form</span></a>
 </li>
<li class="">
  <a href="sect0004.html#a0000000034"><span class="toc_ref">7.2</span> <span class="toc_entry">The finite adeles of the rationals.</span></a>
 </li>
<li class="">
  <a href="sect0004.html#a0000000035"><span class="toc_ref">7.3</span> <span class="toc_entry">The adelic general linear group</span></a>
 </li>
<li class="">
  <a href="sect0004.html#a0000000036"><span class="toc_ref">7.4</span> <span class="toc_entry">Smooth functions</span></a>
 </li>
<li class="">
  <a href="sect0004.html#a0000000037"><span class="toc_ref">7.5</span> <span class="toc_entry">Slowly-increasing functions</span></a>
 </li>
<li class="">
  <a href="sect0004.html#a0000000038"><span class="toc_ref">7.6</span> <span class="toc_entry">Weights at infinity</span></a>
 </li>
<li class="">
  <a href="sect0004.html#a0000000039"><span class="toc_ref">7.7</span> <span class="toc_entry">The action of the universal enveloping algebra.</span></a>
 </li>
<li class="">
  <a href="sect0004.html#a0000000040"><span class="toc_ref">7.8</span> <span class="toc_entry">Automorphic forms</span></a>
 </li>
<li class="">
  <a href="sect0004.html#a0000000041"><span class="toc_ref">7.9</span> <span class="toc_entry">Hecke operators</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="Adele_miniproject.html"><span class="toc_ref">8</span> <span class="toc_entry">Miniproject: Adeles</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="Adele_miniproject.html#a0000000042"><span class="toc_ref">8.1</span> <span class="toc_entry">Status</span></a>
 </li>
<li class="">
  <a href="Adele_miniproject.html#a0000000043"><span class="toc_ref">8.2</span> <span class="toc_entry">The goal</span></a>
 </li>
<li class="">
  <a href="Adele_miniproject.html#a0000000044"><span class="toc_ref">8.3</span> <span class="toc_entry">Local compactness</span></a>
 </li>
<li class="">
  <a href="Adele_miniproject.html#a0000000045"><span class="toc_ref">8.4</span> <span class="toc_entry">Base change</span></a>
 </li>
<li class="">
  <a href="Adele_miniproject.html#a0000000046"><span class="toc_ref">8.5</span> <span class="toc_entry">Discreteness and compactness</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="Haar_char_project.html"><span class="toc_ref">9</span> <span class="toc_entry">Miniproject: Haar Characters</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="Haar_char_project.html#a0000000047"><span class="toc_ref">9.1</span> <span class="toc_entry">The goal</span></a>
 </li>
<li class="">
  <a href="Haar_char_project.html#a0000000048"><span class="toc_ref">9.2</span> <span class="toc_entry">Initial definitions</span></a>
 </li>
<li class="">
  <a href="Haar_char_project.html#a0000000049"><span class="toc_ref">9.3</span> <span class="toc_entry">Examples</span></a>
 </li>
<li class="">
  <a href="Haar_char_project.html#a0000000050"><span class="toc_ref">9.4</span> <span class="toc_entry">Algebras</span></a>
 </li>
<li class="">
  <a href="Haar_char_project.html#a0000000051"><span class="toc_ref">9.5</span> <span class="toc_entry">Left and right multiplication</span></a>
 </li>
<li class="">
  <a href="Haar_char_project.html#a0000000052"><span class="toc_ref">9.6</span> <span class="toc_entry">Finite Products</span></a>
 </li>
<li class="">
  <a href="Haar_char_project.html#a0000000053"><span class="toc_ref">9.7</span> <span class="toc_entry">Some measure-theoretic preliminaries</span></a>
 </li>
<li class="">
  <a href="Haar_char_project.html#a0000000054"><span class="toc_ref">9.8</span> <span class="toc_entry">Restricted products</span></a>
 </li>
<li class="">
  <a href="Haar_char_project.html#a0000000055"><span class="toc_ref">9.9</span> <span class="toc_entry">Adeles</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="Fujisaki_project.html"><span class="toc_ref">10</span> <span class="toc_entry">Miniproject: Fujisaki’s Lemma</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="Fujisaki_project.html#a0000000056"><span class="toc_ref">10.1</span> <span class="toc_entry">The goal</span></a>
 </li>
<li class="">
  <a href="Fujisaki_project.html#a0000000057"><span class="toc_ref">10.2</span> <span class="toc_entry">Initial definitions</span></a>
 </li>
<li class="">
  <a href="Fujisaki_project.html#a0000000058"><span class="toc_ref">10.3</span> <span class="toc_entry">Enter the adeles</span></a>
 </li>
<li class="">
  <a href="Fujisaki_project.html#a0000000059"><span class="toc_ref">10.4</span> <span class="toc_entry">The proof</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="Quat_alg_project.html"><span class="toc_ref">11</span> <span class="toc_entry">Miniproject: Quaternion algebras</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="Quat_alg_project.html#a0000000060"><span class="toc_ref">11.1</span> <span class="toc_entry">The goal</span></a>
 </li>
<li class="">
  <a href="Quat_alg_project.html#a0000000061"><span class="toc_ref">11.2</span> <span class="toc_entry">Initial definitions</span></a>
 </li>
<li class="">
  <a href="Quat_alg_project.html#a0000000062"><span class="toc_ref">11.3</span> <span class="toc_entry">Brief introduction to automorphic forms in this setting</span></a>
 </li>
<li class="">
  <a href="Quat_alg_project.html#a0000000063"><span class="toc_ref">11.4</span> <span class="toc_entry">Definition of spaces of automorphic forms</span></a>
 </li>
<li class="">
  <a href="Quat_alg_project.html#a0000000064"><span class="toc_ref">11.5</span> <span class="toc_entry">The main result</span></a>
 </li>

  </ul>
 </li>
<li class=" active current">
  <a href="HeckeOperator_project.html"><span class="toc_ref">12</span> <span class="toc_entry">Miniproject: Hecke Operators</span></a>
  <span class="expand-toc">▼</span>
  <ul class="sub-toc-1 active">
     <li class="">
  <a href="HeckeOperator_project.html#a0000000065"><span class="toc_ref">12.1</span> <span class="toc_entry">Status</span></a>
 </li>
<li class="">
  <a href="HeckeOperator_project.html#a0000000066"><span class="toc_ref">12.2</span> <span class="toc_entry">The goal</span></a>
 </li>
<li class="">
  <a href="HeckeOperator_project.html#a0000000067"><span class="toc_ref">12.3</span> <span class="toc_entry">The abstract theory</span></a>
 </li>
<li class="">
  <a href="HeckeOperator_project.html#a0000000068"><span class="toc_ref">12.4</span> <span class="toc_entry">Restricted products</span></a>
 </li>
<li class="">
  <a href="HeckeOperator_project.html#a0000000069"><span class="toc_ref">12.5</span> <span class="toc_entry">Some local theory</span></a>
 </li>
<li class="">
  <a href="HeckeOperator_project.html#a0000000070"><span class="toc_ref">12.6</span> <span class="toc_entry">Adelic groups</span></a>
 </li>
<li class="">
  <a href="HeckeOperator_project.html#a0000000071"><span class="toc_ref">12.7</span> <span class="toc_entry">Automorphic forms</span></a>
 </li>
<li class="">
  <a href="HeckeOperator_project.html#a0000000072"><span class="toc_ref">12.8</span> <span class="toc_entry">Concrete Hecke operators</span></a>
 </li>
<li class="">
  <a href="HeckeOperator_project.html#a0000000073"><span class="toc_ref">12.9</span> <span class="toc_entry">Analysis of the Hecke algebra</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="ch_bestiary.html"><span class="toc_ref">13</span> <span class="toc_entry">Appendix: A collection of results which are needed in the proof.</span></a>
  <span class="expand-toc">▶</span>
  <ul class="sub-toc-1">
     <li class="">
  <a href="ch_bestiary.html#a0000000074"><span class="toc_ref">13.1</span> <span class="toc_entry">Results from class field theory</span></a>
 </li>
<li class="">
  <a href="ch_bestiary.html#a0000000075"><span class="toc_ref">13.2</span> <span class="toc_entry">Structures on the points of an affine variety.</span></a>
 </li>
<li class="">
  <a href="ch_bestiary.html#a0000000076"><span class="toc_ref">13.3</span> <span class="toc_entry">Algebraic groups.</span></a>
 </li>
<li class="">
  <a href="ch_bestiary.html#a0000000077"><span class="toc_ref">13.4</span> <span class="toc_entry">Automorphic forms and representations</span></a>
 </li>
<li class="">
  <a href="ch_bestiary.html#a0000000078"><span class="toc_ref">13.5</span> <span class="toc_entry">Galois representations</span></a>
 </li>
<li class="">
  <a href="ch_bestiary.html#a0000000079"><span class="toc_ref">13.6</span> <span class="toc_entry">Algebraic geometry</span></a>
 </li>
<li class="">
  <a href="ch_bestiary.html#a0000000080"><span class="toc_ref">13.7</span> <span class="toc_entry">Algebra</span></a>
 </li>

  </ul>
 </li>
<li class="">
  <a href="sect0005.html"><span class="toc_ref">14</span> <span class="toc_entry">Bibliography</span></a>
 </li>
<li ><a href="dep_graph_chapter_1.html">Chapter 1 graph</a></li>
<li ><a href="dep_graph_chapter_2.html">Chapter 2 graph</a></li>
<li ><a href="dep_graph_chapter_3.html">Chapter 3 graph</a></li>
<li ><a href="dep_graph_chapter_4.html">Chapter 4 graph</a></li>
<li ><a href="dep_graph_chapter_5.html">Chapter 5 graph</a></li>
<li ><a href="dep_graph_chapter_6.html">Chapter 6 graph</a></li>
<li ><a href="dep_graph_chapter_7.html">Chapter 7 graph</a></li>
<li ><a href="dep_graph_chapter_8.html">Chapter 8 graph</a></li>
<li ><a href="dep_graph_chapter_9.html">Chapter 9 graph</a></li>
<li ><a href="dep_graph_chapter_10.html">Chapter 10 graph</a></li>
<li ><a href="dep_graph_chapter_11.html">Chapter 11 graph</a></li>
<li ><a href="dep_graph_chapter_12.html">Chapter 12 graph</a></li>
<li ><a href="dep_graph_chapter_13.html">Chapter 13 graph</a></li>
</ul>
</nav>

<div class="content">
<div class="content-wrapper">


<div class="main-text">
<h1 id="HeckeOperator_project">12 Miniproject: Hecke Operators</h1>

<h1 id="a0000000065">12.1 Status</h1>
<p>This is an active miniproject. The abstract theory is completely formalized; at the time of writing the concrete theory has no sorried definitions but it does have some sorried proofs. </p>
<h1 id="a0000000066">12.2 The goal</h1>
<p>The goal of this project is to get sorry-free definitions of Hecke operators acting on spaces of automorphic forms. These Hecke operators generate Hecke algebras, which are the rings called \(T\) in the modularity lifting theorems, or \(R=T\) theorems, crucially introduced by Wiles in order to prove FLT. </p>
<p>The theory comes in two parts; the “abstract” theory, which is pure algebra, and the “concrete” theory where we apply the abstract constructions to produce endomorphisms of spaces of automorphic forms. The abstract theory is short (and completely formalized); the concrete theory still needs some work because to apply the theory to the adelic groups we care about we need to develop some more API around the theory of restricted products, and of compact open subgroups of matrix groups. </p>
<h1 id="a0000000067">12.3 The abstract theory</h1>
<h2 id="a0000000252">12.3.1 Introduction</h2>
<p>The set-up: we have a commutative ring \(R\), the coefficient ring, and all of our spaces which the operators act on will be \(R\)-modules. </p>
<p>We have a group \(G\) acting \(R\)-linearly on an \(R\)-module \(A\). </p>
<p>We have subgroups \(U\) and \(V\) of \(G\). We will be particularly interested in the \(R\)-modules \(A^U\) and \(A^V\) of invariant elements. </p>
<p>Given an element \(g\in G\), then under a certain finiteness hypothesis we will be able to define an \(R\)-linear map \(T_g\) or \([UgV]\) from \(A^V\) to \(A^U\). The finiteness hypothesis is that the double coset \(UgV\) can be written as a <em>finite</em> union of single cosets \(g_iV\). </p>
<div class="definition_thmwrapper theorem-style-definition" id="AbstractHeckeOperator.HeckeOperator_toFun">
  <div class="definition_thmheading">
    <span class="definition_thmcaption">
    Definition
    </span>
    <span class="definition_thmlabel">12.1</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#AbstractHeckeOperator.HeckeOperator_toFun">#</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/AbstractHeckeOperator.HeckeOperator_toFun" class="lean_decl">AbstractHeckeOperator.HeckeOperator_toFun</a></li>
          
        </ul>
    
      </div>
    </div>

    
        </div>
  </div>
  <div class="definition_thmcontent">
  <p>  Assuming \(UgV\) is a finite union of cosets \(g_iV\), we define \([UgV]:A^V\to A^U\) to be the map sending \(a\in A^V\) to \(\sum _i g_ia.\) </p>

  </div>
</div>
<div class="lemma_thmwrapper theorem-style-plain" id="AbstractHeckeOperator.HeckeOperator">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.2</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#AbstractHeckeOperator.HeckeOperator">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000253"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    <button class="modal"><svg  class="icon icon-mindmap "><use xlink:href="symbol-defs.svg#icon-mindmap"></use></svg>
</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Uses</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="HeckeOperator_project.html#AbstractHeckeOperator.HeckeOperator_toFun">Definition 12.1</a></li>
          
        </ul>
    
      </div>
    </div>

    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/AbstractHeckeOperator.HeckeOperator" class="lean_decl">AbstractHeckeOperator.HeckeOperator</a></li>
          
        </ul>
    
      </div>
    </div>

    
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>   This function is well-defined (that is, independent of the choice of \(g_i\)), has image in \(A^U\) and is \(R\)-linear. </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000253">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p>Well-definedness is because if we change \(g_i\) to \(g'_i:=g_iv\) for some \(v\in V\) then \(g_ia=g_i'a\) because \(a\in A^V\). </p>
<p>The image lands in \(A^U\) because left multiplication by \(u\) fixes \(UgV\) and hence permutes the cosets \(g_iV\). </p>
<p>Finally \(R\)-linearity is because the \(G\)-action is \(R\)-linear. </p>

  </div>
</div>
<p>The group \(G\) is not in general commutative, and hence if \(U=V\) the Hecke operators in this generality do not in general commute as endomorphisms of \(A^U\). Here is a criterion for them to commute. </p>
<div class="lemma_thmwrapper theorem-style-plain" id="AbstractHeckeOperator.comm">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.3</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#AbstractHeckeOperator.comm">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000254"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    <button class="modal"><svg  class="icon icon-mindmap "><use xlink:href="symbol-defs.svg#icon-mindmap"></use></svg>
</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Uses</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="HeckeOperator_project.html#AbstractHeckeOperator.HeckeOperator">Lemma 12.2</a></li>
          
        </ul>
    
      </div>
    </div>

    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/AbstractHeckeOperator.comm" class="lean_decl">AbstractHeckeOperator.comm</a></li>
          
        </ul>
    
      </div>
    </div>

    
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>   Say \(g,h\in G\) and we have \(UgU=\coprod _i g_iU\) and \(UhU=\coprod _j h_j\) and we have \(g_ih_j=h_jg_i\) for all \(i,j\). Then \([UgU][UhU]=[UhU][UgU]\), that is, the Hecke operators acting on \(A^U\) commute. </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000254">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p>We have \([UgU][UhU]a=\sum _ig_i(\sum _jh_ja)=\sum _{i,j}g_ih_ja\) and \([UhU][UgU]a=\sum _jh_j\sum _ig_ia=\sum _{j,i}h_jg_ia\) and these sums are equal because \(g_ih_j=h_jg_i\). </p>

  </div>
</div>
<p>The finiteness hypothesis that the decomposition \(UgV=\coprod _i g_iV\) is into a finite union is necessary for the theory to work. If \(G\) is a topological group then here is a criterion which gives the finiteness hypothesis for free. </p>
<div class="lemma_thmwrapper theorem-style-plain" id="QuotientGroup.mk_image_finite_of_compact_of_open">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.4</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#QuotientGroup.mk_image_finite_of_compact_of_open">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000255"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/QuotientGroup.mk_image_finite_of_compact_of_open" class="lean_decl">QuotientGroup.mk_image_finite_of_compact_of_open</a></li>
          
        </ul>
    
      </div>
    </div>

    
    
    <a class="github_link" href="https://github.com/ImperialCollegeLondon/FLT/issues/563">Discussion</a>
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>   If \(U\) and \(V\) are compact subgroups of a topological group&#160;\(G\), if \(V\) is also open, and if \(g\in G\), then the double coset space \(UgV\) is a finite union of left cosets \(g_iV\). </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000255">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p>The subset \(UgV\) of \(G\) is a continuous image of the compact set \(U\times V\) and is hence compact, and it is covered by the disjoint left cosets \(g_iV\); this cover must thus be finite. </p>

  </div>
</div>
<h1 id="a0000000068">12.4 Restricted products</h1>
<p>In the concrete example of Hecke operators which we care about, the invariants \(A^G\) will be spaces of quaternionic automorphic forms (by definition). We do not need to worry about the definition of \(A\) in this project at all. However we will need to do various computations with the specific groups \(G\) which we are interested in, and they are restricted products. So we now develop some theory for restricted products, starting by recalling the definition. </p>
<p>If \(I\) is an index set, if \(X_i\) are sets indexed by \(i\in I\) and if \(Y_i\) are subsets, then the <em>restricted product</em> \(\prod '_iX_i\) (note the dash) is defined to be the subset of the full product \(\prod _i X_i\) consisting of those tuples \((x_i)\) such that \(x_i\in Y_i\) for all but finitely many&#160;\(i\). We suppress the \(Y_i\) from the notation in this document, although in Lean we cannot do this and the restricted product looks something like \(\prod {}^{r} i,[X\  i, Y\  i]\). </p>
<p>It is straightforward to check that if the \(X_i\) are groups or rings or \(R\)-modules, and the \(Y_i\) are subgroups or subrings or submodules, then the restricted product is a group, ring or \(R\)-module; indeed the structure is inherited via the inclusion \(\prod '_iX_i\subseteq \prod _iX_i\) (and the fact that arbitrary products of groups/rings/modules are groups/rings/modules). </p>
<p>More subtle is the theory of topological space structures. If the \(X_i\) are topological spaces then we do <em>not</em> give \(\prod '_iX_i\) the subspace topology coming from the product topology on \(\prod _iX_i\); instead we give it the finest topology making all of the natural maps \(\prod _{i\in S}X_i\times \prod _{i\notin S}Y_i\to \prod '_iX_i\) continuous, as \(S\) runs through all finite subsets of&#160;\(I\); here the product of \(X_i\)s and \(Y_i\)s has the product topology. For example if all of the \(Y_i\) are open then one can check that \(\prod _iY_i\) is an open subset of \(\prod '_iX_i\) (this is <span class="tt">RestrictedProduct.isOpen_forall_mem</span> in mathlib), whereas it is not of the form \(\left(\prod '_iX_i\right)\cap U\) for any open subset&#160;\(U\) of \(\prod _iX_i\) in general; the map from \(\prod '_i X_i\) to \(\prod _i X_i\) is continuous but is not in general an embedding. </p>
<p>If you’ve seen automorphic forms before, then here is an obvious-sounding claim: because the adeles \(\mathbb {A}_F\) of a number field are a restricted product of completions \(F_v\) with respect to the integer rings \(\mathcal{O}_v\), then \(GL_2(\mathbb {A}_F)\) is obviously topologically a restricted product of \(GL_2(F_v)\) with respect to \(GL_2(\mathcal{O}_v)\). We now spend some time justifying this claim, which is a little more intricate than it sounds. </p>
<h2 id="a0000000256">12.4.1 Products</h2>
<p>Here are some basic facts we need about restricted products. </p>
<div class="lemma_thmwrapper theorem-style-plain" id="Homeomorph.restrictedProductProd">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.5</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#Homeomorph.restrictedProductProd">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000257"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/Homeomorph.restrictedProductProd" class="lean_decl">Homeomorph.restrictedProductProd</a></li>
          
        </ul>
    
      </div>
    </div>

    
    
    <a class="github_link" href="https://github.com/ImperialCollegeLondon/FLT/issues/568">Discussion</a>
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>   If \(A_i\) is a family of topological spaces equipped with open subsets \(B_i\), and if \(C_i\) is a family of topological spaces equipped with open subsets \(D_i\), and if we equip \(A_i\times C_i\) with the open subset \(B_i\times D_i\), then the natural bijection \(\prod '_i(A_i\times C_i)=\left(\prod '_iA_i\right)\times \left(\prod '_iB_i\right)\) is a homeomorphism. </p>

  </div>
</div>
<div class="remark_thmwrapper theorem-style-remark" id="a0000000258">
  <div class="remark_thmheading">
    <span class="remark_thmcaption">
    Remark
    </span>
    <span class="remark_thmlabel">12.6</span>
    <div class="thm_header_extras">

        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#a0000000258">#</a>
    
    
    
        </div>
  </div>
  <div class="remark_thmcontent">
  <p>This may well not be true if \(B_i\) and \(D_i\) are not open, because filtered colimits and binary products do not appear in general to commute in the category of topological spaces. I don’t know an explicit counterexample though. </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000257">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> We need to check continuity in both directions. The easy way is continuity of the map from the restricted product to the map from the binary product; the lemma <span class="tt">RestrictedProduct.continuous_dom</span> in mathlib tells us that a map from a restricted product is continuous when its restriction to \(\left(\prod _{i\in S}(A_i\times C_i)\right)\times \left(\prod _{i\notin S}(B_i\times D_i)\right)\) is continuous for all finite \(S\subseteq I\); the universal property of the binary product tells us that the map into the binary product is continuous iff the maps into the factors are continuous, but the map into \(\prod '_iX_i\) is a product of the natural maps from \(\left(\prod _{i\in S}(A_i\times C_i)\right)\times \left(\prod _{i\notin S}(B_i\times D_i)\right)\) to \(\left(\prod _{i\in S}A_i\right)\times \left(\prod _{i\notin S}B_i\right)\) and the inclusion, and both are known to be continuous (an arbitrary product of continuous maps is continuous, and the other claim is in the restricted product API in mathlib). </p>
<p>The harder direction is the other way, because we are working against both universal properties. The trick is <span class="tt">RestrictedProduct.continuous_dom_prod</span> in mathlib (this is where we assume \(B_i\) and \(D_i\) are open), which tells us that a map out of a binary product of restricted products is continuous when its restriction to \(\left(\left(\prod _{i\in S}A_i\right)\times \left(\prod _{i\notin S}B_i\right)\right)\times \left(\left(\prod _{i\in S}C_i\right)\times \left(\prod _{i\notin S}D_i\right)\right)\) is, for all finite \(S\) (note that the \(S\) in the mathlib lemma is actually our \(I-S\)). The map from this to the restricted product factors through \(\left(\prod _{i\in S}(A_i\times C_i)\right)\times \left(\prod _{i\notin S}(B_i\times D_i)\right)\); the first map is a homeomorphism (use the fact that \(\prod _iX_i\times Y_i\) is homeomorphic to \(\left(\prod _iX_i\right)\times \left(\prod _iY_i\right)\)), and the second is continuous by definition of the topology on a restricted product. </p>

  </div>
</div>
<div class="corollary_thmwrapper theorem-style-plain" id="Homeomorph.restrictedProductPi">
  <div class="corollary_thmheading">
    <span class="corollary_thmcaption">
    Corollary
    </span>
    <span class="corollary_thmlabel">12.7</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#Homeomorph.restrictedProductPi">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000259"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/Homeomorph.restrictedProductPi" class="lean_decl">Homeomorph.restrictedProductPi</a></li>
          
        </ul>
    
      </div>
    </div>

    
    
    <a class="github_link" href="https://github.com/ImperialCollegeLondon/FLT/issues/570">Discussion</a>
        </div>
  </div>
  <div class="corollary_thmcontent">
  <p>   Restricted products (with respect to open subspaces) commute with finite products. In other words, if \(j\) runs through a finite set \(J\) and \(i\) runs through an arbitrary set \(I\), and if \(X_{ji}\) are topological spaces equipped with open subspaces \(Y_{ji}\), then the obvious bijection \(\prod '_i(\prod _j X_{ji})=\prod _j\left(\prod '_i X_{ji}\right)\) is a homeomorphism. </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000259">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> Induction on the size of the finite set, using lemma&#160;<a href="HeckeOperator_project.html#Homeomorph.restrictedProductProd">12.5</a> to get you started. </p>

  </div>
</div>
<p>Let \(n\) be a natural and let \(M_n(X)\) for a set \(X\) denote “\(n\times n\) matrices with coefficient in \(X\)”, i.e. \(X^{n^2}\). If \(X\) is a topological spaces then give \(M_n(X)\) the product topology. </p>
<div class="corollary_thmwrapper theorem-style-plain" id="Homeomorph.restrictedProductMatrix">
  <div class="corollary_thmheading">
    <span class="corollary_thmcaption">
    Corollary
    </span>
    <span class="corollary_thmlabel">12.8</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#Homeomorph.restrictedProductMatrix">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000260"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/Homeomorph.restrictedProductMatrix" class="lean_decl">Homeomorph.restrictedProductMatrix</a></li>
          
        </ul>
    
      </div>
    </div>

    
    
    <a class="github_link" href="https://github.com/ImperialCollegeLondon/FLT/issues/571">Discussion</a>
        </div>
  </div>
  <div class="corollary_thmcontent">
  <p>   If \(X_i\) are topological spaces and the \(Y_i\) are open subspaces, then the obvious map \(M_n(\prod '_iX_i)=\prod '_iM_n(X_i)\) is a homeomorphism. </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000260">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> Immediate from the previous corollary&#160;<a href="HeckeOperator_project.html#Homeomorph.restrictedProductPi">12.7</a>. </p>

  </div>
</div>
<h2 id="a0000000261">12.4.2 Units</h2>
<p>We now want to move from matrices to invertible matrices whilst keeping track of topology, so we need to understand units of topological monoids. Openness of the subobject was crucial in the above arguments, so we need the next lemma before we can get anywhere. </p>
<div class="lemma_thmwrapper theorem-style-plain" id="Submonoid.units_isOpen">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.9</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#Submonoid.units_isOpen">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000262"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/Submonoid.units_isOpen" class="lean_decl">Submonoid.units_isOpen</a></li>
          
        </ul>
    
      </div>
    </div>

    
    
    <a class="github_link" href="https://github.com/ImperialCollegeLondon/FLT/issues/587">Discussion</a>
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>   If \(M\) is a topological monoid and \(U\) is an open submonoid, then the units \(U^\times \) of \(U\) are naturally an open subgroup of \(M^\times \). </p>

  </div>
</div>
<div class="remark_thmwrapper theorem-style-remark" id="a0000000263">
  <div class="remark_thmheading">
    <span class="remark_thmcaption">
    Remark
    </span>
    <span class="remark_thmlabel">12.10</span>
    <div class="thm_header_extras">

        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#a0000000263">#</a>
    
    
    
        </div>
  </div>
  <div class="remark_thmcontent">
  <p>Note that \(M^\times \) doesn’t get the subspace topology from&#160;\(M\), it is embedded into \(M\times M\) via \(g\mapsto (g,g^{-1})\) and gets the subspace topology from the product. This makes it into a topological group. </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000262">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> We have \(U\times U\) is an open subset of \(M\times M\), and if we imagine \(M^\times \) embedded in \(M\times M\) as explained in the remark above, then the intersection of this subgroup with \(U\times U\) is open in \(M^\times \) and consists of the elements of \(M^\times \) which are in \(U\) and whose inverse is also in \(U\), which is easily checked to be the copy of \(U^\times \) we’re talking about. </p>

  </div>
</div>
<p>Later on, compactness will be key for us, so we record the analogous result for compactness. </p>
<div class="lemma_thmwrapper theorem-style-plain" id="Submonoid.units_isCompact">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.11</span>
    <div class="thm_header_extras">

        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#Submonoid.units_isCompact">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000264"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/Submonoid.units_isCompact" class="lean_decl">Submonoid.units_isCompact</a></li>
          
        </ul>
    
      </div>
    </div>

    
    
    <a class="github_link" href="https://github.com/ImperialCollegeLondon/FLT/issues/588">Discussion</a>
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>   If \(M\) is a Hausdorff topological monoid and \(U\) is a compact submonoid, then the units \(U^\times \) of \(U\) are naturally a compact subgroup of \(M^\times \). </p>

  </div>
</div>
<div class="remark_thmwrapper theorem-style-remark" id="a0000000265">
  <div class="remark_thmheading">
    <span class="remark_thmcaption">
    Remark
    </span>
    <span class="remark_thmlabel">12.12</span>
    <div class="thm_header_extras">

        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#a0000000265">#</a>
    
    
    
        </div>
  </div>
  <div class="remark_thmcontent">
  <p>Is Hausdorffness necessary? </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000264">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> First I claim that \(M^\times \) embedded in \(M\times M\) via \(g\mapsto (g,g^{-1})\) is a closed subset of \(M\times M\). Indeed, if \(p:M\times M\to M\) is \((a,b)\mapsto ab\) and \(q:M\times M\to M\) is \((a,b)\mapsto ba\), then \(p\) and \(q\) are continuous, \(M^\times \subseteq M\times M\) is the intersection \(p^{-1}\{ 1\} \cap q^{-1}\{ 1\} \), and \(\{ 1\} \) is closed because \(M\) is Hausdorff. </p>
<p>We have \(U\times U\) is a compact subset of \(M\times M\), and so \(U^\times =M^\times \cap U\times U\) is a closed subspace of a compact space and is thus compact. </p>

  </div>
</div>
<div class="lemma_thmwrapper theorem-style-plain" id="ContinuousMulEquiv.piUnits">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.13</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#ContinuousMulEquiv.piUnits">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000266"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/ContinuousMulEquiv.piUnits" class="lean_decl">ContinuousMulEquiv.piUnits</a></li>
          
        </ul>
    
      </div>
    </div>

    
    
    <a class="github_link" href="https://github.com/ImperialCollegeLondon/FLT/issues/581">Discussion</a>
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>   If \(U_i\) are topological monoids then the canonical group isomorphism \((\prod _i U_i)^\times =\prod _i(U_i^\times )\) is a homeomorphism. </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000266">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p>We prove that the maps in both directions are continuous. Let’s start with the map from left to right. </p>
<p>A map into a product is continuous when the maps to the factors are continuous. A map into the units of a monoid is continuous when the two projection maps to the monoid (the inclusion and the map \(u\mapsto u^{-1}\)) are continuous (because \(M^\times \) has the topology induced from \(M\times M\)). This reduces us to checking that the maps \((\prod _i U_i)^\times \to U_j\) sending \((u_i)\) to \(u_j\) resp \(u_j^{-1}\) are continuous. But the former map is the continuous inclusion \((\prod _i U_i)^\times \to \prod _i U_i\) followed by the continuous projection to \(U_j\), and the latter map is the continuous inclusion \((\prod _i U_i)^\times \to \prod _i U_i\) sending \(x\) to \(x^{-1}\) followed by the projection. </p>
<p>To go the other way: because the units have the induced topology it suffices to check that the two maps \(\prod _i(U_i^\times )\to \prod _i U_i\) sending \((u_i)\) to \((u_i)\) resp \((u_i^{-1})\) are continuous. A map to a product is continuous when the induced maps to the factors are. A projection from a project is continuous, and the identity and inverse are continuous maps \(U_j^\times \to U_j\), and the maps we’re concerned with are composites of these maps and are hence continuous. </p>

  </div>
</div>
<div class="theorem_thmwrapper theorem-style-plain" id="ContinuousMulEquiv.restrictedProductUnits">
  <div class="theorem_thmheading">
    <span class="theorem_thmcaption">
    Theorem
    </span>
    <span class="theorem_thmlabel">12.14</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#ContinuousMulEquiv.restrictedProductUnits">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000267"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/ContinuousMulEquiv.restrictedProductUnits" class="lean_decl">ContinuousMulEquiv.restrictedProductUnits</a></li>
          
        </ul>
    
      </div>
    </div>

    
    
    <a class="github_link" href="https://github.com/ImperialCollegeLondon/FLT/issues/582">Discussion</a>
        </div>
  </div>
  <div class="theorem_thmcontent">
  <p>   If \(M_i\) are a family of topological monoids equipped with open submonoids \(U_i\), then the canonical map \((\prod '_iM_i)^\times \to \prod '_i(M_i^\times )\) is a homeomorphism. </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000267">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> I don’t know a clean way of showing that the map from left to right is continuous, so here is a “direct” proof that the map is a homeomorphism. It is certainly an abstract group isomorphism between topological groups. So to prove that it is a homeomorphism it suffices to prove that it is a homeomorphism near the identity, or equivalently that there are open neighbourhoods \(X\) and \(Y\) of the identity elements on each side such that the map induces a homeomorphism from \(X\) to \(Y\). We choose \((\prod _i U_i)^\times \) and \(\prod _i (U_i^\times )\). Note that the former is open because of lemma&#160;<a href="HeckeOperator_project.html#Submonoid.units_isOpen">12.9</a>. The result now follows from the previous lemma&#160;<a href="HeckeOperator_project.html#ContinuousMulEquiv.piUnits">12.13</a>. </p>

  </div>
</div>
<h1 id="a0000000069">12.5 Some local theory</h1>
<p>We could work over a general nonarchimedean normed field but we still do not have them in mathlib, so we stick to the case of interest which is the completion of a number field&#160;\(K\) at a finite place&#160;\(v\). Such a completion is a topological field&#160;\(K_v\) equipped with a discrete valuation, a ring of integers \(\mathcal{O}_v\) having a principal maximal ideal \((\varpi )\), and a finite residue field \(k_v:=\mathcal{O}_v/(\varpi )\). </p>
<p>There is no formal Lean code for the lemmas in this section; I am slightly dragging my feet because it would seem more sensible to prove them in the right generality, and we don’t have a definition of nonarchimedean local field yet. </p>
<div class="lemma_thmwrapper theorem-style-plain" id="NumberField.isOpenAdicCompletionIntegers">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.15</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#NumberField.isOpenAdicCompletionIntegers">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000268"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/NumberField.isOpenAdicCompletionIntegers" class="lean_decl">NumberField.isOpenAdicCompletionIntegers</a></li>
          
        </ul>
    
      </div>
    </div>

    
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>  \(\mathcal{O}_v\) is an open subring of \(K_v\). </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000268">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p>Openness is already in mathlib. </p>

  </div>
</div>
<div class="lemma_thmwrapper theorem-style-plain" id="NumberField.instCompactSpaceAdicCompletionIntegers">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.16</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#NumberField.instCompactSpaceAdicCompletionIntegers">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000269"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/NumberField.instCompactSpaceAdicCompletionIntegers" class="lean_decl">NumberField.instCompactSpaceAdicCompletionIntegers</a></li>
          
        </ul>
    
      </div>
    </div>

    
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>  \(\mathcal{O}_v\) is a compact subring of \(K_v\). </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000269">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p>Compactness lies a little deeper because it assumes that the residue field of \(K_v\) is finite. </p>

  </div>
</div>
<div class="lemma_thmwrapper theorem-style-plain" id="M2.localFullLevel.isOpen">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.17</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#M2.localFullLevel.isOpen">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000270"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/IsDedekindDomain.M2.localFullLevel.isOpen" class="lean_decl">IsDedekindDomain.M2.localFullLevel.isOpen</a></li>
          
        </ul>
    
      </div>
    </div>

    
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>\(M_2(\mathcal{O}_v)\) is an open subring of \(M_2(K_v)\).   </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000270">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> Topologically \(M_2(\mathcal{O}_v)\cong \mathcal{O}_v^4\) as a subset of \(K_v^4\) so this follows because a product of compacts is compact and a product of opens is open. </p>

  </div>
</div>
<div class="lemma_thmwrapper theorem-style-plain" id="M2.localFullLevel.isCompact">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.18</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#M2.localFullLevel.isCompact">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000271"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/IsDedekindDomain.M2.localFullLevel.isCompact" class="lean_decl">IsDedekindDomain.M2.localFullLevel.isCompact</a></li>
          
        </ul>
    
      </div>
    </div>

    
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>\(M_2(\mathcal{O}_v)\) is a compact subring of \(M_2(K_v)\).   </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000271">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> Topologically \(M_2(\mathcal{O}_v)\cong \mathcal{O}_v^4\) as a subset of \(K_v^4\) so this follows because a product of compacts is compact and a product of opens is open. </p>

  </div>
</div>
<div class="lemma_thmwrapper theorem-style-plain" id="nolean-compactopen-GL2">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.19</span>
    <div class="thm_header_extras">

        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#nolean-compactopen-GL2">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000272"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>\(GL_2(\mathcal{O}_v)\) is a compact open subgroup of \(GL_2(K_v)\).  </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000272">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> \(K_v\) is known to be Hausdorff, so \(M_2(K_v)\) is Hausdorff and the results follow from lemmas&#160;<a href="HeckeOperator_project.html#Submonoid.units_isOpen">12.9</a> and&#160;<a href="HeckeOperator_project.html#Submonoid.units_isCompact">12.11</a>. </p>

  </div>
</div>
<p>Recall that there is a projection \(\mathcal{O}_v\to k_v\) where \(k_v\) is the residue field of&#160;\(v\), a finite field. This induces a ring homomorphism \(M_2(\mathcal{O}_v)\to M_2(k_v)\) with kernel \(M_2(\varpi \mathcal{O}_v)\), an ideal&#160;\(I\) of \(M_2(\mathcal{O}_v)\) isomorphic to \((\varpi \mathcal{O}_v)^4\) and hence also compact and open. </p>
<p>Say \(\Gamma _v\) is a subgroup of \(GL_2(k_v)\). Then \(\Gamma _v\) is finite. Consider it as a submonoid of the multiplicative monoid \(M_2(k_v)\). Its preimage&#160;\(U_v\) in \(M_2(\mathcal{O}_v)\) is easily checked to be a submonoid of \(M_2(\mathcal{O}_v)\); furthermore it is a finite union of cosets of \(I\) and is hence compact and open as a submonoid of \(M_2(\mathcal{O}_v)\) and hence of \(M_2(K_v)\). </p>
<div class="lemma_thmwrapper theorem-style-plain" id="nolean-compactopen-U1p">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.20</span>
    <div class="thm_header_extras">

        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#nolean-compactopen-U1p">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000273"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p> \(U_v\) is a compact open subgroup of \(GL_2(K_v)\). </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000273">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> \(\Gamma _v\) is a group and hence its preimage \(U_v\) is a subgroup of the monoid \(M_2(K_v)\). It is compact and open as we just saw. Hence its units (also \(U_v\)) are a subgroup of \(GL_2(K_v)\), which is compact and open, again by lemmas&#160;<a href="HeckeOperator_project.html#Submonoid.units_isOpen">12.9</a> and&#160;<a href="HeckeOperator_project.html#Submonoid.units_isCompact">12.11</a>. </p>

  </div>
</div>
<p>Say now \(\begin{pmatrix} 1

& *

\\ 0

& 1

\end{pmatrix}\subseteq \Gamma _v\subseteq \begin{pmatrix} *

& *

\\ 0

& *

\end{pmatrix}\) and let \(U:=U_v\) be its preimage in \(GL_2(\mathcal{O}_v)\), considered as a compact open subgroup of \(GL_2(K_v)\). Choose \(0\not=\alpha \in \mathcal{O}_v\) and define \(g=\begin{pmatrix} \alpha 

& 0

\\ 0

& 1

\end{pmatrix}\in GL_2(K_v)\). Let’s do an explicit double coset decomposition in preparation for a calculation with Hecke operators. </p>
<div class="lemma_thmwrapper theorem-style-plain" id="bijOn_unipotent_mul_diagU1_U1diagU1">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.21</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#bijOn_unipotent_mul_diagU1_U1diagU1">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000274"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/TotallyDefiniteQuaternionAlgebra.WeightTwoAutomorphicForm.HeckeOperator.Local.bijOn_unipotent_mul_diagU1_U1diagU1" class="lean_decl">TotallyDefiniteQuaternionAlgebra.WeightTwoAutomorphicForm.HeckeOperator.Local.bijOn_unipotent_mul_diagU1_U1diagU1</a></li>
          
        </ul>
    
      </div>
    </div>

    
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p>  The double coset space \(UgU\) is the disjoint union of \(g_tU\) as \(t\) ranges through \(\mathcal{O}_v/\alpha \mathcal{O}_v\) and \(g_t:=\begin{pmatrix} \alpha 

& \tilde{t}

\\ 0

& 1

\end{pmatrix}\), where \(\tilde{t}\) is any lift of \(t\) to \(\mathcal{O}_v\). </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000274">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p>We first manipulate the statement into a statement about finite groups. We have \(UgU=\coprod _t g_tU\iff UgUg^{-1}=\coprod _t g_tUg^{-1}=\coprod _t g_tg^{-1}(gUg^{-1})\). By the second isomorphism theorem this is true if \(U=\coprod _t g_tg^{-1}(gUg^{-1}\cap U)\). So when is an element of \(U\) in \(gUg^{-1}\)? Equivalently, if \(x\in U\), when is \(g^{-1}xg\in U\)? An explicit calculation of matrices shows us that this is true iff \(g=\begin{pmatrix}  a

& b

\\ c

& d

\end{pmatrix}\) with \(\alpha \mid b\). Define \(U^\alpha \) to be this subgroup of&#160;\(U\). We have reduced the question to showing that the matrices \(h_t:=\begin{pmatrix} 1

& \tilde{t}

\\ 0

& 1

\end{pmatrix}\) are a set of left coset representatives for the subgroup \(U^\alpha \) of \(U\). </p>
<p>It thus suffices to show that if \(u=\begin{pmatrix}  a

& b

\\ c

& d

\end{pmatrix}\in U\) then \(u\in h_tU^\alpha \) iff \(b\in \mathcal{O}_v\) reduces mod \(\alpha \) to \(t\in \mathcal{O}_v/\alpha \). We do this by computing \(h_t^{-1}u=\begin{pmatrix}  a-\tilde{t}c

& b-\tilde{t}d

\\ c

& d

\end{pmatrix}\) and observing that its top right hand entry mod&#160;\(\alpha \) is zero iff \(b\) mod \(\alpha \) is \(t\). </p>

  </div>
</div>
<h1 id="a0000000070">12.6 Adelic groups</h1>
<p>We are finally ready to discuss the group&#160;\(G\) and the subgroups&#160;\(U\) which we will be using to define our Hecke operators. Let&#160;\(K\) be a number field, let&#160;\(D\) a quaternion algebra over&#160;\(K\) and let \(\mathbb {A}_K^\infty \) be the finite adeles of&#160;\(K\); recall that this is a commutative topological ring, defined to be the restricted product of the commutative topological fields&#160;\(K_v\) as \(v\) runs through the finite places of&#160;\(K\), with respect to the compact open subrings \(\mathcal{O}_v\). </p>
<p>The group&#160;\(G\) we are interested in for the rest of this miniproject is the group \((D\otimes _K\mathbb {A}_K^\infty )^\times \). We want to write down compact open subgroups of this group, but the first thing we need to do is to find a way of talking about elements of the group. </p>
<p>We will assume that there exists an \(\mathbb {A}_K^\infty \)-algebra isomorphism \(D\otimes _K\mathbb {A}_K^\infty =M_2(\mathbb {A}_K^\infty )\) and we will fix such an isomorphism \(r\) (called a <em>rigidification</em> in the Lean code). We give both of these \(\mathbb {A}_K^\infty \)-algebras the \(\mathbb {A}_K^\infty \)-module topology, which is a fancy way of saying the product topology (they are both free of rank 4 as \(\mathbb {A}_K^\infty \)-modules); the rigidification is then a homeomorphism (because all \(\mathbb {A}_K^\infty \)-module maps between modules with the \(\mathbb {A}_K^\infty \)-module topology are continuous). </p>
<p>This means that our group&#160;\(G\) is isomorphic (both algebraically and topologically) to \(GL_2(\mathbb {A}_K^\infty )\). Before we go any further, let say something about matrix rings over complete fields. </p>
<div class="theorem_thmwrapper theorem-style-plain" id="GL2.restrictedProduct">
  <div class="theorem_thmheading">
    <span class="theorem_thmcaption">
    Theorem
    </span>
    <span class="theorem_thmlabel">12.22</span>
    <div class="thm_header_extras">

    
    ✓
        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#GL2.restrictedProduct">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000275"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
    <button class="modal lean">L∃∀N</button>
        <div class="modal-container">
      <div class="modal-content">
        <header>
          <h1>Lean declarations</h1>
          <button class="closebtn"><svg  class="icon icon-cross "><use xlink:href="symbol-defs.svg#icon-cross"></use></svg>
</button>
        </header>
        
        <ul class="uses">
          
          <li><a href="https://ImperialCollegeLondon.github.io/FLT/docs/find/#doc/IsDedekindDomain.FiniteAdeleRing.GL2.restrictedProduct" class="lean_decl">IsDedekindDomain.FiniteAdeleRing.GL2.restrictedProduct</a></li>
          
        </ul>
    
      </div>
    </div>

    
        </div>
  </div>
  <div class="theorem_thmcontent">
  <p>  \(G\) is isomorphic and homeomorphic to the restricted product of \(GL_2(K_v)\) with respect to the compact open subgroups \(GL_2(\mathcal{O}_v)\). </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000275">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p> This follows from lemma&#160;<a href="HeckeOperator_project.html#ContinuousMulEquiv.restrictedProductUnits">12.14</a> and lemma&#160;<a href="HeckeOperator_project.html#Homeomorph.restrictedProductMatrix">12.8</a>. </p>

  </div>
</div>
<p>If&#160;\(S\) is a finite set of finite places of&#160;\(K\), and for each \(v\in S\) we choose a subgroup \(\Gamma _v\) of \(GL_2(k_v)\) then we saw in the previous section how to create a compact open subgroup \(\tilde{\Gamma }_v\) of \(GL_2(K_v)\). For \(v\notin S\) define \(\tilde{\Gamma }_v=GL_2(\mathcal{O}_v)\). Then \(\prod _v\tilde{\Gamma }_v\) is a compact open subgroup of \(\prod _vGL_2(\mathcal{O}_v)\). It is compact subgroups of this form which we shall be using. </p>
<h1 id="a0000000071">12.7 Automorphic forms</h1>
<p>We recall some of the definitions of spaces of automorphic forms, from the quaternion algebra project, section&#160;<a href="Quat_alg_project.html">11</a>. </p>
<p>We fix a totally real field&#160;\(F\), a totally definite quaternion algebra&#160;\(D/F\), and a coefficient (additive abelian) group&#160;\(R\). Set \(G=(D\otimes _F\mathbb {A}_F^\infty )^\times \) as in the previous section. Note that \(G\) naturally contains copies of \(D^\times \) and \((\mathbb {A}_F^\infty )^\times \). Recall from definition&#160;<a href="Quat_alg_project.html#TotallyDefiniteQuaternionAlgebra.WeightTwoAutomorphicForm">11.1</a> that an \(R\)-valued weight&#160;2 automorphic form is a function \(f:G\to R\) satisfying the following axioms: </p>
<ol class="enumerate">
  <li><p>\(f(dg)=f(g)\) for all \(d\in D^\times \subseteq (D\otimes _F\mathbb {A}_F^\times )\); </p>
</li>
  <li><p>There exists a compact open subgroup of&#160;\(U\) (the <em>level</em> of&#160;\(f\)) such that \(f(gu)=f(g)\) for all \(g\in G\) and \(u\in U\); </p>
</li>
  <li><p>\(f(gz)=f(g)\) for all \(z\in (\mathbb {A}_F^\infty )^\times \). </p>
</li>
</ol>
<p>It can be checked that the collection of all such forms is an additive abelian group, and if&#160;\(R\) is a ring then it is naturally an&#160;\(R\)-module. Let’s call this group&#160;\(A\) for short. Then&#160;\(A\) has a left action of \(G\), with \(g\cdot f\) defined via \((g\cdot f)(x):=f(xg)\). Recall from definition&#160;<a href="Quat_alg_project.html#TotallyDefiniteQuaternionAlgebra.WeightTwoAutomorphicFormOfLevel">11.5</a> that a weight 2 automorphic form of level&#160;\(U\) is simply an element of the fixed points \(A^U\). In other words, the forms of level&#160;\(U\) are the forms satisfying the three axioms defining an automorphic form but with the compact open subgroup in the second axiom being&#160;\(U\). </p>
<h1 id="a0000000072">12.8 Concrete Hecke operators</h1>
<p>Let&#160;\(F\) be a number field. For each finite place \(v\) we have the completion \(F_v\) of \(F\) at \(v\), which is a normed field equipped with its integer ring \(\mathcal{O}_v\), a local ring with finite residue field&#160;\(k_v\). </p>
<p>For \(v\) a finite place of&#160;\(F\), let \(\Delta _v\) be a subgroup of \(k_v^\times \) and consider the subgroup \(\Gamma _v\) of \(GL_2(k_v)\) consisting of matrices \(\begin{pmatrix} a

& b

\\ 0

& d

\end{pmatrix}\) with \(a,d\in k_v^\times \) and \(a/d\in \Delta _v\). Then </p>
<p>It is easily checked that this is a subgroup, and that \(\begin{pmatrix} 1

& *

\\ 0

& 1

\end{pmatrix}\subseteq \Gamma _v\subseteq \begin{pmatrix} *

& *

\\ 0

& *

\end{pmatrix},\) so lemma&#160;?? applies. Let \(U_{\Delta _v}\) be the preimage of this subgroup in \(GL_2(\mathcal{O}_v)\). This is a compact open subgroup of \(GL_2(\mathcal{O}_v)\), by the remarks above. </p>
<p>Let&#160;\(S\) be a finite set of finite places of&#160;\(F\), and define \(U_\Delta (S)\) to be the matrices in \(\prod _v GL_2(\mathcal{O}_v)\) which are in \(U_{\Delta _v}\) for all \(v\in S\) (we put no condition at the places \(v\notin S\)). We can consider \(U_{\Delta }(S)\) as a subgroup of \(GL_2(\mathbb {A}_F^\infty )\); it is a product of compact subgroups and thus compact, and it is a product of opens all but finitely many of which are \(GL_2(\mathcal{O}_v)\) and is thus open. Because the inclusion \(\prod _v GL_2(\mathcal{O}_v)\to GL_2(\mathbb {A}_F^\infty )\) is an open embedding, we can regard \(U_\Delta (S)\) as a compact open subgroup of \(GL_2(\mathbb {A}_F^\infty )\). </p>
<p>If we fix \(r\) a rigidification, it induces an isomorphism \(GL_2(\mathbb {A}_F^\infty )=(D\otimes _F\mathbb {A}_F^\infty )^\times \) and so we can identify&#160;\(U_\Delta (S)\) with its image in \((D\otimes _F\mathbb {A}_F^\infty )\). </p>
<p>We introduce Hecke operators of two types. </p>
<p>First, for \(v\) any place not in&#160;\(S\) we choose a uniformiser \(\varpi _v\in F_v\), form the invertible \(2\times 2\) matrix \(\begin{pmatrix} \varpi _v

& 0

\\ 0

& 1

\end{pmatrix}\in GL_2(F_v)\) and extend this element to an element \(g\in G\) by letting its component at all finite places \(w\not=v\) be the identity. We define the Hecke operator \(T_v:A^U\to A^U\) to be \([UgU]\), using the notation defined at the beginning of this section. </p>
<p>For the second kind of Hecke operator we choose \(0\not=\alpha \in \mathcal{O}_v\) and we consider the \(2\times 2\) matrix in \(GL_2(\mathbb {A}_K^\infty )\) which is \(\begin{pmatrix} \alpha 

& 0

\\ 0

& 1

\end{pmatrix}\) at&#160;\(v\) and 1 at all other local components. Via the rigidification&#160;\(r\) we obtain an element \(g\in G\). We define the Hecke operator \(U_{v,\alpha }\) to be \([UgU]\). </p>
<p>The Hecke algebra of interest to us will be generated by the Hecke operators \(T_v\) for \(v\notin S\) and \(U_{v,\alpha }\) for \(v\in S\). </p>
<p>The big theorem we want in this section is </p>
<div class="theorem_thmwrapper theorem-style-plain" id="nolean-hecke-algebra-commutative-noetherian">
  <div class="theorem_thmheading">
    <span class="theorem_thmcaption">
    Theorem
    </span>
    <span class="theorem_thmlabel">12.23</span>
    <div class="thm_header_extras">

        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#nolean-hecke-algebra-commutative-noetherian">#</a>
    
    
    
        </div>
  </div>
  <div class="theorem_thmcontent">
  <p> Say&#160;\(R\) is a Noetherian ring. Then the subalgebra of the \(R\)-linear endomorphisms of \(A^U\) generated by the Hecke operators \(T_v\) for \(v\notin S\) and \(U_{v,\alpha }\) for \(v\in S\) is a Noetherian commutative ring. </p>

  </div>
</div>
<h1 id="a0000000073">12.9 Analysis of the Hecke algebra</h1>
<p>First we discuss commutativity of the Hecke operators. First, assume that \(v\not\in S\). Then \(U=GL_2(\mathcal{O}_v)\times U'\) where \(U'\) is a subgroup of the restricted product of \(GL_2(F_w)\) for \(w\not=v\). We can use <span class="tt">RestrictedProduct.SubmonoidClass.isProductAt</span> to express this concept of being an internal direct product. If \(g\) is the element of \(G\) used to make \(T_v\) then \(g\) is also supported at \(w\), so the double coset space \(UgU\) is just \((GL_2(\mathcal{O}_v)\begin{pmatrix} \varpi 

& 0

\\ 0

& 1

\end{pmatrix}GL_2(\mathcal{O}_v))\times U'\) and in particular can be decomposed into single left \(U\)-cosets of the form \(g_iU\) where \(g_i\) is also supported at&#160;\(v\). This is <span class="tt">RestrictedProduct.mem_coset_and_mulSupport_subset_of_isProductAt</span>. </p>
<p>Similarly if \(v\in S\), if \(0\not=\alpha \in \mathcal{O}_v\) and if \(g_v=\begin{pmatrix} \alpha 

& 0

\\ 0

& 1

\end{pmatrix}\) and is 1 elsewhere, then the double coset space \(UgU\) can again be written as \(\coprod _i g_iU\) with the \(g_i\) supported only at&#160;\(v\). </p>
<p>We deduce immediately from lemma&#160;<a href="HeckeOperator_project.html#AbstractHeckeOperator.comm">12.3</a> that two Hecke operators associated to different finite places of&#160;\(F\) commute. What remains is to check that \(U_{\alpha ,v}\) and \(U_{\beta ,v}\) commute. In fact we claim more, namely that \(U_{\alpha ,v}U_{\beta ,v}=U_{\alpha \beta ,v}\). This will suffice because \(\alpha \beta =\beta \alpha \). </p>
<div class="lemma_thmwrapper theorem-style-plain" id="nolean-product-of-U-alpha">
  <div class="lemma_thmheading">
    <span class="lemma_thmcaption">
    Lemma
    </span>
    <span class="lemma_thmlabel">12.24</span>
    <div class="thm_header_extras">

        </div>
    <div class="thm_header_hidden_extras">

    <a class="icon proof" href="HeckeOperator_project.html#nolean-product-of-U-alpha">#</a>
    
    <a class="icon proof" href="HeckeOperator_project.html#a0000000276"><svg  class="icon icon-cogs "><use xlink:href="symbol-defs.svg#icon-cogs"></use></svg>
</a>
    
    
    
        </div>
  </div>
  <div class="lemma_thmcontent">
  <p> If \(v\in S\) and \(\begin{pmatrix} 1

& *

\\ 0

& 1

\end{pmatrix}\subseteq \Gamma _v\subseteq \begin{pmatrix} *

& *

\\ 0

& *

\end{pmatrix}\) then \(U_{\alpha ,v}U_{\beta ,v}=U_{\alpha \beta ,v}\). </p>

  </div>
</div>
<div class="proof_wrapper" id="a0000000276">
  <div class="proof_heading">
    <span class="proof_caption">
    Proof
    </span>
    <span class="expand-proof">▶</span>
  </div>
  <div class="proof_content">
  <p>Follows easily from the explicit double coset decomposition proved above. </p>

  </div>
</div>
<p>The reason that the Hecke algebra is Noetherian is that the main theorem of the Fujisaki miniproject immediately implies that \(A^G\) is a submodule of a finite free \(R\)-module and is hence Noetherian. Its endomorphism algebra is hence a Noetherian \(R\)-module, so the sub-\(R\)-algebra generated by the Hecke operators is also a Noetherian \(R\)-module and thus a Noetherian ring.  </p>

</div> <!--main-text -->
</div> <!-- content-wrapper -->
</div> <!-- content -->
</div> <!-- wrapper -->

<nav class="prev_up_next">
  <svg  id="showmore-minus" class="icon icon-eye-minus showmore"><use xlink:href="symbol-defs.svg#icon-eye-minus"></use></svg>

  <svg  id="showmore-plus" class="icon icon-eye-plus showmore"><use xlink:href="symbol-defs.svg#icon-eye-plus"></use></svg>

  <a href="Quat_alg_project.html" title="Miniproject: Quaternion algebras"><svg  class="icon icon-arrow-left "><use xlink:href="symbol-defs.svg#icon-arrow-left"></use></svg>
</a>
  <a href="index.html" title="Towards a Lean proof of Fermat’s Last Theorem"><svg  class="icon icon-arrow-up "><use xlink:href="symbol-defs.svg#icon-arrow-up"></use></svg>
</a>
  <a href="ch_bestiary.html" title="Appendix: A collection of results which are needed in the proof."><svg  class="icon icon-arrow-right "><use xlink:href="symbol-defs.svg#icon-arrow-right"></use></svg>
</a>
</nav>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/plastex.js"></script>
<script type="text/javascript" src="js/svgxuse.js"></script>
<script type="text/javascript" src="js/js.cookie.min.js"></script>
<script type="text/javascript" src="js/showmore.js"></script>
</body>
</html>